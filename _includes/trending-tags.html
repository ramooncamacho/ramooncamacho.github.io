<!-- The trending tags list -->

{% assign MAX = 10 %}

{%- comment -%}
  Initialize the tag map that will store entries in the form "tag::count"
{%- endcomment -%}
{% assign tag_map = '' | split: '' %}

{%- comment -%}
  Iterate over all articles to count tag occurrences
{%- endcomment -%}
{% for article in site.articles %}
  {% if article.tags %}
    {% for tag in article.tags %}
      {% assign found = false %}
      {% assign new_tag_map = '' | split: '' %}

      {%- comment -%}
        Search for the tag in the existing map and update its count
      {%- endcomment -%}
      {% for entry in tag_map %}
        {% assign parts = entry | split: '::' %}
        {% assign tag_name = parts[0] %}
        {% assign count = parts[1] | plus: 0 %}

        {% if tag_name == tag %}
          {% assign count = count | plus: 1 %}
          {% assign found = true %}
        {% endif %}

        {% assign new_entry = tag_name | append: '::' | append: count %}
        {% assign new_tag_map = new_tag_map | push: new_entry %}
      {% endfor %}

      {%- comment -%}
        If the tag wasn't found, add it with count 1
      {%- endcomment -%}
      {% unless found %}
        {% assign new_entry = tag | append: '::1' %}
        {% assign new_tag_map = new_tag_map | push: new_entry %}
      {% endunless %}

      {% assign tag_map = new_tag_map %}
    {% endfor %}
  {% endif %}
{% endfor %}

{%- comment -%}
  Sort tags by count (descending)
{%- endcomment -%}
{% assign sorted_tag_map = tag_map | sort: 'split::1' | reverse %}

{%- comment -%}
  Pick the top MAX tags
{%- endcomment -%}
{% assign trending_tags = '' | split: '' %}
{% for entry in sorted_tag_map limit: MAX %}
  {% assign tag_name = entry | split: '::' | first %}
  {% assign trending_tags = trending_tags | push: tag_name %}
{% endfor %}

{%- comment -%}
  Render trending tags
{%- endcomment -%}
{% if trending_tags.size > 0 %}
  <section>
    <h2 class="panel-heading">{{- site.data.locales[include.lang].panel.trending_tags -}}</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      {% for tag_name in trending_tags %}
        {% assign encoded_tag = tag_name | url_encode %}
        {% assign tag_url = '/tag/?tag=' | append: encoded_tag %}
        <a class="post-tag btn btn-outline-primary" href="{{ tag_url }}">{{ tag_name }}</a>
      {% endfor %}
    </div>
  </section>
{% endif %}
